#! /usr/bin/env bash
set -e

_nodefile="$(pwd)/nodefile"
_exec="$(pwd)/oncillamem"
_404str_oncilla="Error: oncillamem not found. \
    launch must exist and execute from same dir."
_404str_nodefile="Error: nodefile not found. \
    Must exist in same dir as oncillamem."

function _launch
{
    nodes=$(wc -l $_nodefile | cut -f 1 -d ' ')
    echo mpiexec -np $nodes -npernode 1 -hostfile $nodefile $_exec
    #mpiexec -np $nodes -npernode 1 -hostfile $_nodefile $_exec
    mpiexec --mca btl_tcp_if_include eth1 -np $nodes -npernode 1 -hostfile $_nodefile $_exec
}

[ ! -e $_exec ] && echo $_404str_oncilla && exit 1
[ ! -e $_nodefile ] && echo $_404str_nodefile && exit 1

_launch
